{"result":[{"item":"node","sys_mod_count":"5","active":"true","sys_updated_on":"2014-11-04 22:19:24","sys_tags":"","type":"menu","script":"// Rerun the currently selected layout algorithm using the given node as if it were the root\nrunLayout();\n\nfunction runLayout() {\n\t// Re-run layout algorithms for nodes and links\n    bsmNodeLayout.runCurrentLayout(bsmGraph.current(), item);\n    bsmLinkLayout.recalculateAllLinks(bsmGraph.current());\n\t\n\t// Draw to update the graph itself over 1.25 seconds\n    bsmRenderer.drawAll(1250);\n\t\n\t// Fit the graph to screen and move the camera to fit the view over 1.00 seconds\n    bsmCamera.fitToScreen(bsmGraph.current());\n    bsmCamera.moveCamera(1000);\n}","sys_class_name":"ngbsm_context_menu","sys_id":"09ab3533d7003100976a69418e610312","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"","sys_update_name":"ngbsm_context_menu_09ab3533d7003100976a69418e610312","sys_updated_by":"admin","sys_created_on":"2014-11-04 21:55:29","name":"Run Layout From Here","sys_name":"Run Layout From Here","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"120","sys_policy":""},{"item":"node","sys_mod_count":"17","active":"true","sys_updated_on":"2015-05-06 22:44:04","sys_tags":"","type":"menu","script":"focus();\n\nfunction focus() {\n\t// Load a graph from the selected node\n\tbsmRepository.loadGraph(item.id, bsmURL.getParameter('level')).then(function() {\n\t\t// After the data is loaded broadcast an event to notify BSM that there is new data to render\n\t\t$rootScope.$broadcast('ngbsm.new_graph_loaded');\n\t});\n}","sys_class_name":"ngbsm_context_menu","sys_id":"20074f513722210052e2cc028e41f1ad","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"item != bsmGraph.current().root && (!item.isCollapsed || item.isCluster)","sys_update_name":"ngbsm_context_menu_20074f513722210052e2cc028e41f1ad","sys_updated_by":"admin","sys_created_on":"2014-08-14 19:25:47","name":"View Map","sys_name":"View Map","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"20","sys_policy":""},{"item":"node","sys_mod_count":"9","active":"true","sys_updated_on":"2015-05-07 00:01:01","sys_tags":"","type":"line","script":"/* This separator goes after the 'view form' and 'view map' options */","sys_class_name":"ngbsm_context_menu","sys_id":"3a9b76513722210052e2cc028e41f179","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.isCollapsed || item.isCluster","sys_update_name":"ngbsm_context_menu_3a9b76513722210052e2cc028e41f179","sys_updated_by":"admin","sys_created_on":"2014-08-14 18:36:21","name":"--","sys_name":"--","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"30","sys_policy":""},{"item":"node","sys_mod_count":"1","active":"true","sys_updated_on":"2015-06-01 19:45:47","sys_tags":"","type":"line","script":"/* The separator goes near the bottom to seperate the load more option */","sys_class_name":"ngbsm_context_menu","sys_id":"3dc8e983d71002002f6d69418e61031d","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"","sys_update_name":"ngbsm_context_menu_3dc8e983d71002002f6d69418e61031d","sys_updated_by":"admin","sys_created_on":"2015-06-01 19:04:29","name":"--","sys_name":"--","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"130","sys_policy":""},{"item":"node","sys_mod_count":"13","active":"true","sys_updated_on":"2015-05-06 22:33:32","sys_tags":"","type":"menu","script":"// Open the form view for this CI\nwindow.open(item.cidetail);","sys_class_name":"ngbsm_context_menu","sys_id":"41b9f2513722210052e2cc028e41f1c8","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.isCollapsed || item.isCluster","sys_update_name":"ngbsm_context_menu_41b9f2513722210052e2cc028e41f1c8","sys_updated_by":"admin","sys_created_on":"2014-08-14 18:27:39","name":"View Form","sys_name":"View Form","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"10","sys_policy":""},{"item":"node","sys_mod_count":"36","active":"true","sys_updated_on":"2016-08-31 11:39:59","sys_tags":"","type":"menu","script":"var _loading= function(rootId, selectedItem){\n\tbsmRepository.loadGraph(rootId, bsmURL.getParameter('level'), selectedItem.collapsedIds.split(','), undefined, selectedItem.isCluster, selectedItem.id).then(function() {\n\t\t// Signal BSM to rerender once we have new data\n\t\t$rootScope.$broadcast('ngbsm.new_graph_loaded');\n\t});\n};\n\nfunction _showConfirmationDialog(rootId, selectedItem) {\n\tvar dialogConfig = {\n\t\ttitle : i18n.getMessage('Map update:'),\n\t\tmsg : i18n.getMessage('If you continue with the current update to the map, changes previously made by a Load More operation â€“ will be lost'),\n\t\tbuttons:[{\n\t\t\tlabel : i18n.getMessage('Cancel'),\n\t\t\tcss: 'btn-default',\n\t\t\tonClick : function (){}\n\t\t\t},{\n\t\t\t\tlabel : i18n.getMessage('Continue'),\n\t\t\t\tcss: 'btn-primary',\n\t\t\t\tonClick : function (){\n\t\t\t\t\tgraphWasChanged = false;\n\t\t\t\t\t_loading(rootId, selectedItem);\n\t\t\t\t}\n\t\t\t}\n\t\t\t]\n\t};\n\t$rootScope.$broadcast('ngbsm.open_bsm_dialog', dialogConfig);\n}\n\nfunction expand() {\n\t// Focus and fetch data for the selected CI, passing a list of sys_id's for nodes\n\t// inside the group to prevent them from being collapsed\n\tvar id = bsmGraph.current().root.id;\n\n\n\t//Need to send a warnning (the sate probably will be lost), in case the graph was changed already by other action (e.g. loadMore)\n\tif (graphWasChanged){\n\t\t_showConfirmationDialog(id , item);\t\t\n\t} else {\n\t\t_loading(id , item);\n\t}\t\t\t\n}\nexpand();\t\n\t\n\t","sys_class_name":"ngbsm_context_menu","sys_id":"5691d3b7d7532100976a69418e61037d","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"item.isCollapsed","sys_update_name":"ngbsm_context_menu_5691d3b7d7532100976a69418e61037d","sys_updated_by":"admin","sys_created_on":"2014-10-31 21:23:57","name":"Expand","sys_name":"Expand","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"100","sys_policy":""},{"item":"link","sys_mod_count":"4","active":"true","sys_updated_on":"2016-01-18 08:50:20","sys_tags":"","type":"menu","script":"// Prompt for modification of a relationship type\nmodify();\n\nfunction modify() {\n\tbsmRelationships.modifyRelationship(item);\n}","sys_class_name":"ngbsm_context_menu","sys_id":"5b748e33d7003100976a69418e6103b9","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.id.startsWith('from_')","sys_update_name":"ngbsm_context_menu_5b748e33d7003100976a69418e6103b9","sys_updated_by":"idan.mirochnick","sys_created_on":"2014-11-04 22:34:08","name":"Modify Relationship","sys_name":"Modify Relationship","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"1030","sys_policy":""},{"item":"node","sys_mod_count":"14","active":"true","sys_updated_on":"2015-01-15 20:41:52","sys_tags":"","type":"menu","script":"// Open a list of tasks that have this CI as an affected item\nwindow.open('/task_ci_list.do?sysparm_query=ci_item=' + item.id);","sys_class_name":"ngbsm_context_menu","sys_id":"5d6a36513722210052e2cc028e41f14c","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.isCollapsed","sys_update_name":"ngbsm_context_menu_5d6a36513722210052e2cc028e41f14c","sys_updated_by":"admin","sys_created_on":"2014-08-14 18:30:41","name":"View Affected CIs","sys_name":"View Affected CIs","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"50","sys_policy":""},{"item":"node","sys_mod_count":"18","active":"true","sys_updated_on":"2016-02-21 13:11:02","sys_tags":"","type":"menu","script":"loadMore();\n\nfunction loadMore() {\n\t// Fetch more data as if were were loading the graph from the given CI, but append\n\t// the loaded data instead of switching to the new data set\n\t\n\t// First check that we are not trying to load from a collapsed nodes(Cluster Virtual& Group)\n\tif(item.isCollapsed) {\n\t\tconsole.error(\"MENU ACTION ->'Load More' menu action should not work on collapsed node\",item);\n\t}\n\telse {\n\t\t// Perform a basic load of data from the selected node\n\t\tbsmRepository.expandGraph(item.id, bsmURL.getParameter('level'), undefined, undefined , 'loadMore').then(function() {\n\t\t\t// Signal BSM to rerender once we have new data\n\t\t\t$rootScope.$broadcast('ngbsm.new_graph_loaded');\n\t\t});\n\t}\n}\n","sys_class_name":"ngbsm_context_menu","sys_id":"62858702d71002002f6d69418e6103e4","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"item != bsmGraph.current().root && !item.isCollapsed ","sys_update_name":"ngbsm_context_menu_62858702d71002002f6d69418e6103e4","sys_updated_by":"admin","sys_created_on":"2015-05-29 23:15:51","name":"Load More","sys_name":"Load More","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"140","sys_policy":""},{"item":"node","sys_mod_count":"26","active":"true","sys_updated_on":"2016-08-31 11:37:09","sys_tags":"","type":"menu","script":"function _collapseVirtualGraph(rootId, selectedItem) {\n\t// Collapsed back to virtual group\n\tbsmRepository.collapseGraph(rootId, selectedItem).then(function() {\n\t\t// Signal BSM to rerender once we have new data\n\t\t$rootScope.$broadcast('ngbsm.new_graph_loaded');\n\t});\n}\n\nfunction _collapseClusterGraph(rootId) {\n\t// Simply reload the data without any sticky nodes specified\n\tbsmRepository.loadGraph(rootId, bsmURL.getParameter('level')).then(function() {\n\t\t// Signal BSM to rerender once we have new data\n\t\t$rootScope.$broadcast('ngbsm.new_graph_loaded');\n\t});\n}\n\nfunction _showConfirmationDialog(rootId, selectedItem) {\n\tvar dialogConfig = {\n\t\ttitle : i18n.getMessage('Map update:'),\n\t\tmsg : i18n.getMessage('If you continue with the current update to the map, changes previously made by a Load More operation â€“ will be lost'),\n\t\tbuttons:[{\n\t\t\tlabel : i18n.getMessage('Cancel'),\n\t\t\tcss: 'btn-default',\n\t\t\tonClick : function (){}\n\t\t\t},{\n\t\t\t\tlabel : i18n.getMessage('Continue'),\n\t\t\t\tcss: 'btn-primary',\n\t\t\t\tonClick : function (){\n\t\t\t\t\tgraphWasChanged = false;\n\t\t\t\t\t_collapseVirtualGraph(rootId, selectedItem);\n\t\t\t\t}\n\t\t\t}\n\t\t\t]\n\t};\n\t$rootScope.$broadcast('ngbsm.open_bsm_dialog', dialogConfig);\n}\n\t\nfunction collapse() {\n\t\tvar id = bsmGraph.current().root.id;\n\t\t\n\t\tif (item.isCluster){\n\t\t\t_collapseClusterGraph(id);\n\t\t} else {\n\t\t\t//Need to send a warnning (the sate probably will be lost), in case the graph was changed already by other action (e.g. loadMore)\n\t\t\tif (graphWasChanged){\n\t\t\t\t_showConfirmationDialog(id, item );\t\n\t\t\t} else {\n\t\t\t\t_collapseVirtualGraph(id, item);\n\t\t\t}\n\t\t}\n}\ncollapse();","sys_class_name":"ngbsm_context_menu","sys_id":"628a36513722210052e2cc028e41f14e","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.isCollapsed && ( item.isCluster || bsmRepository.canCollpaseToVirtualGroup(item) );","sys_update_name":"ngbsm_context_menu_628a36513722210052e2cc028e41f14e","sys_updated_by":"admin","sys_created_on":"2014-09-11 18:31:18","name":"Collapse","sys_name":"Collapse","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"110","sys_policy":""},{"item":"link","sys_mod_count":"8","active":"true","sys_updated_on":"2016-01-18 08:49:33","sys_tags":"","type":"line","script":"/* This separator goes after 'view relationship form' and before modification and other options */","sys_class_name":"ngbsm_context_menu","sys_id":"739fafecd7132100976a69418e610303","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.id.startsWith('from_')","sys_update_name":"ngbsm_context_menu_739fafecd7132100976a69418e610303","sys_updated_by":"idan.mirochnick","sys_created_on":"2014-09-18 21:14:52","name":"--","sys_name":"--","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"1020","sys_policy":""},{"item":"node","sys_mod_count":"101","active":"true","sys_updated_on":"2018-01-19 23:02:57","sys_tags":"","type":"menu","script":"// Open a list of outages for this CI\nvar relatedOutagesString;\nvar lowerBoundProperty = 'cmdb.recent_outages.days_ago';\nvar higherBoundProperty = 'cmdb.recent_outages.days_ahead';\nvar relatedOutages = new GlideRecord('cmdb_outage_ci_mtom');\nrelatedOutages.addQuery('ci_item', item.id);\nrelatedOutages.query();\nwhile(relatedOutages.next()) {\n\tif (relatedOutagesString)\n\t\trelatedOutagesString = relatedOutagesString + ',' + relatedOutages.getValue('outage');\n\telse\n\t\trelatedOutagesString = relatedOutages.getValue('outage');\n}\nvar lowerBoundDays;\nvar higherBoundDays;\nvar boundDays = new GlideRecord('sys_properties');\nboundDays.addQuery('name','IN',lowerBoundProperty+','+higherBoundProperty);\nboundDays.query();\nwhile (boundDays.next()) {\n\tvar currentProp = boundDays.getValue('name');\n\tif(currentProp === lowerBoundProperty)\n\t\tlowerBoundDays = boundDays.getValue('value');\n\telse \n\t\thigherBoundDays = boundDays.getValue('value');\n\t\n\tif (!lowerBoundDays)\n\t\tlowerBoundDays = '7';\n\tif (!higherBoundDays)\n\t\thigherBoundDays= '14';\t\n}\n\nif (relatedOutagesString) {\t\n\twindow.g_navigation.open('/cmdb_ci_outage_list.do?sysparm_query=endRELATIVEGE@dayofweek@ago@'+lowerBoundDays+'%5EORendISEMPTY%5EbeginRELATIVELE@dayofweek@ahead@'+higherBoundDays+'%5Ecmdb_ci='+ item.id +'%5EORsys_idIN' + relatedOutagesString,'_blank');\n}\nelse\n\twindow.open('/cmdb_ci_outage_list.do?sysparm_query=endRELATIVEGE@dayofweek@ago@'+lowerBoundDays+'%5EORendISEMPTY%5EbeginRELATIVELE@dayofweek@ahead@'+higherBoundDays+'%5Ecmdb_ci=' + item.id);","sys_class_name":"ngbsm_context_menu","sys_id":"74c9f2513722210052e2cc028e41f1c9","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.isCollapsed","sys_update_name":"ngbsm_context_menu_74c9f2513722210052e2cc028e41f1c9","sys_updated_by":"sameep.kodia","sys_created_on":"2016-07-17 18:27:54","name":"View Recent Outages","sys_name":"View Recent Outages","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"60","sys_policy":""},{"item":"node","sys_mod_count":"5","active":"true","sys_updated_on":"2015-05-07 00:02:30","sys_tags":"","type":"menu","script":"// Kick off the relationship creation process from the current node\nstartAdd();\n\nfunction startAdd() {\n\tbsmRelationships.createRelationship(item);\n}","sys_class_name":"ngbsm_context_menu","sys_id":"95fb3533d7003100976a69418e610313","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.isCollapsed || item.isCluster","sys_update_name":"ngbsm_context_menu_95fb3533d7003100976a69418e610313","sys_updated_by":"admin","sys_created_on":"2014-11-04 21:56:52","name":"Add Relationship","sys_name":"Add Relationship","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"80","sys_policy":""},{"item":"node","sys_mod_count":"5","active":"true","sys_updated_on":"2014-11-04 22:18:38","sys_tags":"","type":"menu","script":"// Open a list of tasks for this CI\nwindow.open('/task_list.do?sysparm_query=active=true^cmdb_ci=' + item.id);","sys_class_name":"ngbsm_context_menu","sys_id":"9799f133d7003100976a69418e61038a","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.isCollapsed","sys_update_name":"ngbsm_context_menu_9799f133d7003100976a69418e61038a","sys_updated_by":"admin","sys_created_on":"2014-11-04 21:46:38","name":"View Related Tasks","sys_name":"View Related Tasks","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"40","sys_policy":""},{"item":"node","sys_mod_count":"10","active":"true","sys_updated_on":"2015-01-15 20:38:16","sys_tags":"","type":"line","script":"/* The separator goes after view options and before all other options, we don't display it if none of the view options were shown */","sys_class_name":"ngbsm_context_menu","sys_id":"a0578f513722210052e2cc028e41f127","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.isCollapsed","sys_update_name":"ngbsm_context_menu_a0578f513722210052e2cc028e41f127","sys_updated_by":"admin","sys_created_on":"2014-08-14 19:27:08","name":"--","sys_name":"--","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"70","sys_policy":""},{"item":"canvas","sys_mod_count":"7","active":"true","sys_updated_on":"2016-09-12 08:05:38","sys_tags":"","type":"menu","script":"// Reset, recalculate and reapply filters\nbsmFilters.resetFilters();\nbsmFilters.enumerateFilters(bsmGraph.current());\nbsmFilters.applyFilters(bsmGraph.current());\n\n// Redraw the graph to refect updated filtering\n// 1000 is the duration in milliseconds to animate the rendering\nbsmRenderer.drawAll(1000);\nbsmFilters.firePostResetEvent();\n","sys_class_name":"ngbsm_context_menu","sys_id":"a8935470d7532100976a69418e6103fc","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"","sys_update_name":"ngbsm_context_menu_a8935470d7532100976a69418e6103fc","sys_updated_by":"admin","sys_created_on":"2015-05-13 23:55:45","name":"Reset Filters","sys_name":"Reset Filters","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"2040","sys_policy":""},{"item":"canvas","sys_mod_count":"4","active":"true","sys_updated_on":"2015-01-15 20:38:41","sys_tags":"","type":"line","script":"/* This separator goes after the layout options and before the 'reset filter' and other options */","sys_class_name":"ngbsm_context_menu","sys_id":"d23f03b7d7532100976a69418e61034b","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"","sys_update_name":"ngbsm_context_menu_d23f03b7d7532100976a69418e61034b","sys_updated_by":"admin","sys_created_on":"2014-09-28 21:13:56","name":"--","sys_name":"--","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"2030","sys_policy":""},{"item":"node","sys_mod_count":"20","active":"true","sys_updated_on":"2017-03-28 13:02:33","sys_tags":"","type":"menu","script":"// Branch based on if there is a selection of multiple CIs or not\nif(bsmSelection.getSelection().nodes.length > 1)\n\taddMultipleAffectedCIs();\nelse\n\taddAffectedCI();\n\n// Function to add one CI as an affected CI\nfunction addAffectedCI() {\n    var taskId = bsmURL.getParameter('fromTask');\n    var cmdbId = item.id;\n\t\n\t// Only process if there is a valid task and CI \n    if (taskId && cmdbId) {\n\t\t// Validate that the CI is not already an affected CI\n        var affectedCI = new GlideRecord('task_ci');\n        affectedCI.addQuery('task', taskId);\n        affectedCI.addQuery('ci_item', cmdbId);\n        affectedCI.query();\n        if (!affectedCI.hasNext()) {\n\t\t\t// Since it did not exist, add it as an affected CI\n            affectedCI.task = taskId;\n            affectedCI.ci_item = cmdbId;\n            affectedCI.insert();\n\t\n\t\t\t// Send message notifying that the CI was added\n            $rootScope.$broadcast('ngbsm.success', {\n                success: 'The CI ' + item.name + ' has been added as an affected CI'\n            });\n        } else {\n\t\t\t// Send a message that the CI is already an affected CI\n\t\t\t$rootScope.$broadcast('ngbsm.success', {\n                success: 'The CI ' + item.name + ' is already an affected CI'\n            });\n\t\t}\n    }\n}\n\n// Function to add all selected CIs as affected CIs\nfunction addMultipleAffectedCIs() {\n    var taskId = bsmURL.getParameter('fromTask');\n\tvar nodes = bsmSelection.getSelection().nodes;\n\tvar added = '';\n\t\n\t// Only process if there is a valid task ID\n    if (taskId) {\n\t\t// Add all CI's in the current selection if they are node clusters/collapsed\n\t\tfor(var i = 0; i < nodes.length; i++) {\n\t\t\tif(!nodes[i].isCollapsed || nodes[i].isCluster) {\n\t\t\t\t// Attempt to add the CI as an affected CI\n\t\t\t\tvar affectedCI = new GlideRecord('task_ci');\n\t\t\t\taffectedCI.addQuery('task', taskId);\n\t\t\t\taffectedCI.addQuery('ci_item', nodes[i].id);\n\t\t\t\taffectedCI.query();\n\t\t\t\tif (!affectedCI.hasNext()) {\n\t\t\t\t\taffectedCI.task = taskId;\n\t\t\t\t\taffectedCI.ci_item = nodes[i].id;\n\t\t\t\t\taffectedCI.insert();\n\n\t\t\t\t\t// If added, add it to the list of added CIs\n\t\t\t\t\tif(added === '')\n\t\t\t\t\t\tadded += nodes[i].name;\n\t\t\t\t\telse\n\t\t\t\t\t\tadded += ', ' + nodes[i].name;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Notify user of which CI's got added or that they didn't get added\n\t\tif(added !== '') {\n\t\t\t$rootScope.$broadcast('ngbsm.success', {\n\t\t\t\tsuccess: added + ' have been added as affected CIs'\n\t\t\t});\n\t\t} else {\n\t\t\t$rootScope.$broadcast('ngbsm.success', {\n\t\t\t\tsuccess: 'Selected CIs are already affected CIs or cannot be added'\n\t\t\t});\n\t\t}\n    }\n}","sys_class_name":"ngbsm_context_menu","sys_id":"d2f8b2513722210052e2cc028e41f191","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"bsmURL.getParameter('fromTask') != null && (!item.isCollapsed || item.isCluster)","sys_update_name":"ngbsm_context_menu_d2f8b2513722210052e2cc028e41f191","sys_updated_by":"binyamin.greenberg","sys_created_on":"2014-08-14 18:25:06","name":"Add Affected CI(s)","sys_name":"Add Affected CI(s)","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"90","sys_policy":""},{"item":"canvas","sys_mod_count":"0","active":"true","sys_updated_on":"2014-11-04 22:28:12","sys_tags":"","type":"menu","script":"// Rerun the currently selected layout algorithm using the root node as a starting point\nrunLayout();\n\nfunction runLayout() {\n\t// Re-run layout algorithms for nodes and links\n    bsmNodeLayout.runCurrentLayout(bsmGraph.current(), bsmGraph.current().root);\n    bsmLinkLayout.recalculateAllLinks(bsmGraph.current());\n\t\n\t// Draw to update the graph itself over 1.25 seconds\n    bsmRenderer.drawAll(1250);\n\t\n\t// Fit the graph to screen and move the camera to fit the view over 1.00 seconds\n    bsmCamera.fitToScreen(bsmGraph.current());\n    bsmCamera.moveCamera(1000);\n}","sys_class_name":"ngbsm_context_menu","sys_id":"d4234e33d7003100976a69418e610389","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"","sys_update_name":"ngbsm_context_menu_d4234e33d7003100976a69418e610389","sys_updated_by":"admin","sys_created_on":"2014-11-04 22:28:12","name":"Run Layout","sys_name":"Run Layout","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"2010","sys_policy":""},{"item":"link","sys_mod_count":"3","active":"true","sys_updated_on":"2016-01-18 08:50:45","sys_tags":"","type":"menu","script":"// Prompt for deletion of a relationship\nremove();\n\nfunction remove() {\n\tbsmRelationships.deleteRelationship(item);\n}","sys_class_name":"ngbsm_context_menu","sys_id":"e6a48e33d7003100976a69418e6103ba","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.id.startsWith('from_')","sys_update_name":"ngbsm_context_menu_e6a48e33d7003100976a69418e6103ba","sys_updated_by":"idan.mirochnick","sys_created_on":"2014-11-04 22:34:54","name":"Delete Relationship","sys_name":"Delete Relationship","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"1040","sys_policy":""},{"item":"link","sys_mod_count":"12","active":"true","sys_updated_on":"2016-01-18 08:48:17","sys_tags":"","type":"menu","script":"// Open the relationship record form view\nwindow.open('/cmdb_rel_ci.do?sys_id=' + item.id);","sys_class_name":"ngbsm_context_menu","sys_id":"f5ea36513722210052e2cc028e41f19c","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"!item.id.startsWith('from_')","sys_update_name":"ngbsm_context_menu_f5ea36513722210052e2cc028e41f19c","sys_updated_by":"admin","sys_created_on":"2014-08-14 18:32:54","name":"View Relationship Form","sys_name":"View Relationship Form","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"1010","sys_policy":""},{"item":"canvas","sys_mod_count":"0","active":"true","sys_updated_on":"2014-11-04 22:29:48","sys_tags":"","type":"menu","script":"// Fit the graph to the viewport in its current configuration\nfitToScreen();\n\nfunction fitToScreen() {\n\t// Fit the graph to screen and move the camera to fit the view over 1.00 seconds\n    bsmCamera.fitToScreen(bsmGraph.current());\n    bsmCamera.moveCamera(1000);\n}","sys_class_name":"ngbsm_context_menu","sys_id":"fb734e33d7003100976a69418e6103d0","sys_package":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_package/b9d7abbf04b12210559073c06a02f7c9","value":"b9d7abbf04b12210559073c06a02f7c9"},"condition":"","sys_update_name":"ngbsm_context_menu_fb734e33d7003100976a69418e6103d0","sys_updated_by":"admin","sys_created_on":"2014-11-04 22:29:48","name":"Fit To Screen","sys_name":"Fit To Screen","sys_scope":{"link":"https://dev315171.service-now.com/api/now/v1/table/sys_scope/global","value":"global"},"sys_created_by":"admin","order":"2020","sys_policy":""}]}